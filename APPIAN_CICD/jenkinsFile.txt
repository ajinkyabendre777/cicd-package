def transitionInput =
							  [
								  transition: [
									  id: '31'
								  ]
							  ]
def newIssue = [fields: [ project: 	 [key: 'EOB'],
												 summary: 'BUG CREATED FROM JENKINS',
												 description: 'Test scenario failed ${params.JIRA_NUMBER}',
												 issuetype: [name: 'Bug']]]
pipeline {
agent any
tools {
    jdk 'JAVA_HOME'
  }
    stages {
        stage('Checkout') {
            steps {
			
			     bat "echo ***************JIRA NUMBER:${params.JIRA_NUMBER}*********************"
				 bat "echo ***************JIRA APPIAN_DEPLOYMENT_UUID:${params.APPIAN_DEPLOYMENT_UUID}*********************"
				 
				checkout([$class: 'GitSCM', branches: [[name: '*/main']], doGenerateSubmoduleConfigurations: false, extensions: [[$class:'RelativeTargetDirectory',relativeTargetDir:'cicd']], submoduleCfg: [], userRemoteConfigs: [[credentialsId: '078a033c-83da-48a1-a078-6ab95f5ceac8', url: 'https://github.com/ajinkyabendre777/coforge-cicd-package.git']]]) 
				
                checkout([$class: 'GitSCM', branches: [[name: '*/main']], doGenerateSubmoduleConfigurations: false, extensions: [[$class:'RelativeTargetDirectory',relativeTargetDir:'test']], submoduleCfg: [], userRemoteConfigs: [[credentialsId: '078a033c-83da-48a1-a078-6ab95f5ceac8', url: 'https://github.com/ajinkyabendre777/coforge-eos-acceptance-test.git']]]) 
				

            }
        }	
		
		stage(Test) {
			steps {
			withMaven(maven: 'MAVEN_HOME') { 
			  bat "cd test"
			  bat "dir"
			  bat "mvn -f test/pom.xml clean install"
			  
			 }
			}
			post {
                success {
				    
                    cucumber buildStatus: 'null', failedFeaturesNumber: -1, failedScenariosNumber: -1, failedStepsNumber: -1, fileIncludePattern: '**/cucumber.json', pendingStepsNumber: -1, skippedStepsNumber: -1, sortingMethod: 'ALPHABETICAL', undefinedStepsNumber: -1
					
					
					withEnv(['JIRA_SITE=jira-site']) {		  

							  jiraTransitionIssue idOrKey: JIRA_NUMBER, input: transitionInput
							  
							}
							
					 powershell "cicd\\APPIAN_CICD\\downloadDeploymentPackage.ps1 EOS ${params.APPIAN_DEPLOYMENT_UUID}"
                }
				failure{
				
				    cucumber buildStatus: 'null', failedFeaturesNumber: -1, failedScenariosNumber: -1, failedStepsNumber: -1, fileIncludePattern: '**/cucumber.json', pendingStepsNumber: -1, skippedStepsNumber: -1, sortingMethod: 'ALPHABETICAL', undefinedStepsNumber: -1
					
					withEnv(['JIRA_SITE=jira-site']) {
								jiraNewIssue issue: newIssue							
						}
				}
		
			}	
	
		}
		
		
		stage(DeployToUAT) {
			steps {
			  powershell "cicd\\APPIAN_CICD\\01_deploy.ps1 EOS ${params.JIRA_NUMBER} UAT"
			}
		
		}
		
	}
}